<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Stok Gudang Barcode</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 10px;
}
h2, h3 {
    text-align: center;
}
input, select, button {
    padding: 6px;
    margin: 4px;
}
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    margin-top: 10px;
}
th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
}
th {
    background: #333;
    color: #fff;
}
button {
    cursor: pointer;
}
.hapus {
    background: red;
    color: white;
}
.kirim {
    background: orange;
    color: white;
}
.retur {
    background: green;
    color: white;
}
#reader {
    width: 100%;
    margin-top: 10px;
}
</style>
</head>

<body>

<h2>Aplikasi Stok Gudang Barcode</h2>

<div>
    <input type="date" id="tanggal">
    <input type="text" id="barcode" placeholder="Scan Barcode">
    <input type="text" id="product" placeholder="Nama Produk">
    <input type="number" id="qty" placeholder="Qty">
    <input type="number" id="hargaBeli" placeholder="Harga Beli">
    <input type="number" id="hargaJual" placeholder="Harga Jual">
    <select id="tipe">
        <option value="masuk">Barang Masuk</option>
        <option value="kirim">Kirim Paket</option>
        <option value="retur">Retur</option>
    </select>
    <br>
    <button onclick="scanBarcode()">ðŸ“· Scan Barcode</button>
    <button onclick="tambahData()">Simpan</button>
</div>

<div id="reader"></div>

<table>
<thead>
<tr>
    <th>No</th>
    <th>Tanggal</th>
    <th>Produk</th>
    <th>Qty</th>
    <th>Harga Beli</th>
    <th>Harga Jual</th>
    <th>Laba</th>
    <th>Jumlah</th>
    <th>Status</th>
    <th>Aksi</th>
</tr>
</thead>
<tbody id="tabelData"></tbody>
</table>

<h3>Total Laba Bulanan: Rp <span id="totalBulanan">0</span></h3>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
let data = JSON.parse(localStorage.getItem("stokGudang")) || [];

function simpan() {
    localStorage.setItem("stokGudang", JSON.stringify(data));
    tampil();
}

function tambahData() {
    let tgl = tanggal.value;
    let produk = product.value;
    let qtyVal = parseInt(qty.value);
    let beli = parseInt(hargaBeli.value);
    let jual = parseInt(hargaJual.value);
    let tipe = document.getElementById("tipe").value;

    if (tipe === "kirim" || tipe === "retur") {
        qtyVal = -Math.abs(qtyVal);
    }

    let laba = (jual - beli) * qtyVal;
    let jumlah = jual * qtyVal;

    data.push({
        tgl, produk, qty: qtyVal,
        beli, jual, laba, jumlah, tipe
    });

    simpan();
}

function tampil() {
    let html = "";
    let total = 0;

    data.forEach((d, i) => {
        total += d.laba;
        html += `
        <tr>
            <td>${i + 1}</td>
            <td>${d.tgl}</td>
            <td>${d.produk}</td>
            <td>${d.qty}</td>
            <td>${d.beli}</td>
            <td>${d.jual}</td>
            <td>${d.laba}</td>
            <td>${d.jumlah}</td>
            <td>${d.tipe}</td>
            <td>
                <button class="hapus" onclick="hapus(${i})">Hapus</button>
            </td>
        </tr>`;
    });

    tabelData.innerHTML = html;
    totalBulanan.innerText = total;
}

function hapus(i) {
    data.splice(i, 1);
    simpan();
}

function scanBarcode() {
    document.getElementById("reader").innerHTML = "";
    const reader = new Html5Qrcode("reader");
    reader.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        code => {
            barcode.value = code;
            reader.stop();
        }
    );
}

tampil();
</script>

</body>
</html>
